; Supervisor Configuration for Laravel Queue Worker
; Copy this file to /etc/supervisor/conf.d/ on your production server
; File: /etc/supervisor/conf.d/laravel-queue-worker.conf

[program:laravel-queue-worker]
; Command to run the queue worker
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/laravel-app/artisan queue:work redis --sleep=3 --tries=3 --max-time=3600 --timeout=60
; Adjust the path above to match your deployment path

; Start multiple workers for better performance
; Adjust numprocs based on your server capacity
numprocs=3

; Auto-start and auto-restart configuration
autostart=true
autorestart=true

; User to run the process as (should match your web server user)
user=www-data

; Logging configuration
stdout_logfile=/var/www/html/laravel-app/storage/logs/queue-worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/www/html/laravel-app/storage/logs/queue-worker-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

; Stop signals
stopsignal=QUIT
stopwaitsecs=60

; Restart policy - automatically restart if worker exits unexpectedly
; This is critical for production reliability
startretries=3

; Environment variables (optional)
; environment=LARAVEL_ENV="production"

; After making changes to this file, run:
; sudo supervisorctl reread
; sudo supervisorctl update
; sudo supervisorctl start laravel-queue-worker:*

; To check status:
; sudo supervisorctl status laravel-queue-worker:*

; To restart all workers:
; sudo supervisorctl restart laravel-queue-worker:*

; To stop all workers:
; sudo supervisorctl stop laravel-queue-worker:*
